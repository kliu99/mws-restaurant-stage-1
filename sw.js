self.importScripts("https://unpkg.com/dexie@2.0.4/dist/dexie.min.js"),self.importScripts("/js/dbhelper.js");const CACHE_NAME="restaurant-review-v2",IMG_CACHE_NAME="restaurant-review-imgs",ALL_CACHES=[CACHE_NAME,IMG_CACHE_NAME];function servePhoto(e){var t=e.url.replace(/-\d+px\.jpg$/,"");return caches.open(IMG_CACHE_NAME).then(s=>s.match(t).then(n=>n||fetch(e).then(e=>(s.put(t,e.clone()),e))))}self.addEventListener("install",e=>{e.waitUntil(caches.open(CACHE_NAME).then(e=>(console.log("Opened cache"),e.addAll(["/","/restaurant.html","js/main.js","js/restaurant_info.js","js/dbhelper.js","css/styles.css","https://unpkg.com/leaflet@1.3.1/dist/leaflet.css","https://unpkg.com/leaflet@1.3.1/dist/leaflet.js","https://unpkg.com/dexie@latest/dist/dexie.min.js","https://unpkg.com/dexie@2.0.4/dist/dexie.min.js"]))))}),self.addEventListener("activate",e=>{e.waitUntil(caches.keys().then(e=>Promise.all(e.filter(e=>e.startsWith("restaurant-review-")&&!ALL_CACHES.includes(e)).map(e=>caches.delete(e)))))}),self.addEventListener("fetch",function(e){var t=new URL(e.request.url);t.origin===location.origin&&t.pathname.startsWith("/img")?e.respondWith(servePhoto(e.request)):e.respondWith(caches.match(e.request,{ignoreSearch:!0}).then(t=>t||fetch(e.request)))});